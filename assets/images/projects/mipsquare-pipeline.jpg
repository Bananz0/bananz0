<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800" viewBox="0 0 1200 800">
  <defs>
    <linearGradient id="grad4" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:rgb(20,20,24);stop-opacity:1" />
      <stop offset="100%" style="stop-color:rgb(30,30,38);stop-opacity:1" />
    </linearGradient>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="rgb(245, 158, 11)" />
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="800" fill="url(#grad4)"/>
  
  <!-- Title -->
  <text x="600" y="50" font-family="Space Grotesk, sans-serif" font-size="32" font-weight="700" fill="rgb(245, 158, 11)" text-anchor="middle">5-Stage MIPS Pipeline</text>
  <text x="600" y="80" font-family="Inter, sans-serif" font-size="16" fill="rgba(229, 231, 235, 0.6)" text-anchor="middle">Instruction Flow & Hazard Mitigation</text>
  
  <!-- Pipeline stages -->
  <rect x="100" y="130" width="180" height="120" rx="6" fill="rgba(245, 158, 11, 0.1)" stroke="rgb(245, 158, 11)" stroke-width="2"/>
  <text x="190" y="160" font-family="Space Grotesk, sans-serif" font-size="18" font-weight="700" fill="rgb(245, 158, 11)" text-anchor="middle">IF</text>
  <text x="190" y="185" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">Instruction</text>
  <text x="190" y="205" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">Fetch</text>
  <text x="190" y="235" font-family="JetBrains Mono, monospace" font-size="11" fill="rgba(229, 231, 235, 0.5)" text-anchor="middle">PC + 4</text>
  
  <rect x="310" y="130" width="180" height="120" rx="6" fill="rgba(34, 211, 238, 0.1)" stroke="rgb(34, 211, 238)" stroke-width="2"/>
  <text x="400" y="160" font-family="Space Grotesk, sans-serif" font-size="18" font-weight="700" fill="rgb(34, 211, 238)" text-anchor="middle">ID</text>
  <text x="400" y="185" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">Instruction</text>
  <text x="400" y="205" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">Decode</text>
  <text x="400" y="235" font-family="JetBrains Mono, monospace" font-size="11" fill="rgba(229, 231, 235, 0.5)" text-anchor="middle">Reg Read</text>
  
  <rect x="520" y="130" width="180" height="120" rx="6" fill="rgba(16, 185, 129, 0.1)" stroke="rgb(16, 185, 129)" stroke-width="2"/>
  <text x="610" y="160" font-family="Space Grotesk, sans-serif" font-size="18" font-weight="700" fill="rgb(16, 185, 129)" text-anchor="middle">EX</text>
  <text x="610" y="185" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">Execute</text>
  <text x="610" y="205" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">ALU Op</text>
  <text x="610" y="235" font-family="JetBrains Mono, monospace" font-size="11" fill="rgba(229, 231, 235, 0.5)" text-anchor="middle">Compute</text>
  
  <rect x="730" y="130" width="180" height="120" rx="6" fill="rgba(147, 51, 234, 0.1)" stroke="rgb(147, 51, 234)" stroke-width="2"/>
  <text x="820" y="160" font-family="Space Grotesk, sans-serif" font-size="18" font-weight="700" fill="rgb(147, 51, 234)" text-anchor="middle">MEM</text>
  <text x="820" y="185" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">Memory</text>
  <text x="820" y="205" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">Access</text>
  <text x="820" y="235" font-family="JetBrains Mono, monospace" font-size="11" fill="rgba(229, 231, 235, 0.5)" text-anchor="middle">LW/SW</text>
  
  <rect x="940" y="130" width="180" height="120" rx="6" fill="rgba(236, 72, 153, 0.1)" stroke="rgb(236, 72, 153)" stroke-width="2"/>
  <text x="1030" y="160" font-family="Space Grotesk, sans-serif" font-size="18" font-weight="700" fill="rgb(236, 72, 153)" text-anchor="middle">WB</text>
  <text x="1030" y="185" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">Write</text>
  <text x="1030" y="205" font-family="Inter, sans-serif" font-size="13" fill="rgba(229, 231, 235, 0.7)" text-anchor="middle">Back</text>
  <text x="1030" y="235" font-family="JetBrains Mono, monospace" font-size="11" fill="rgba(229, 231, 235, 0.5)" text-anchor="middle">Reg Write</text>
  
  <!-- Flow arrows -->
  <line x1="280" y1="190" x2="310" y2="190" stroke="rgb(245, 158, 11)" stroke-width="3" marker-end="url(#arrowhead)"/>
  <line x1="490" y1="190" x2="520" y2="190" stroke="rgb(34, 211, 238)" stroke-width="3" marker-end="url(#arrowhead)"/>
  <line x1="700" y1="190" x2="730" y2="190" stroke="rgb(16, 185, 129)" stroke-width="3" marker-end="url(#arrowhead)"/>
  <line x1="910" y1="190" x2="940" y2="190" stroke="rgb(147, 51, 234)" stroke-width="3" marker-end="url(#arrowhead)"/>
  
  <!-- Pipeline registers -->
  <rect x="290" y="175" width="12" height="30" fill="rgba(245, 158, 11, 0.3)"/>
  <rect x="500" y="175" width="12" height="30" fill="rgba(34, 211, 238, 0.3)"/>
  <rect x="710" y="175" width="12" height="30" fill="rgba(16, 185, 129, 0.3)"/>
  <rect x="920" y="175" width="12" height="30" fill="rgba(147, 51, 234, 0.3)"/>
  
  <!-- Forwarding paths (data hazard mitigation) -->
  <text x="100" y="310" font-family="Space Grotesk, sans-serif" font-size="20" font-weight="600" fill="rgba(229, 231, 235, 0.9)">Forwarding Paths</text>
  
  <!-- EX/MEM -> EX forwarding -->
  <path d="M 820 260 Q 820 320 610 320 Q 610 260 610 250" stroke="rgb(147, 51, 234)" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
  <text x="715" y="335" font-family="Inter, sans-serif" font-size="12" fill="rgb(147, 51, 234)">EX/MEM → EX</text>
  
  <!-- MEM/WB -> EX forwarding -->
  <path d="M 1030 260 Q 1030 350 610 350 Q 610 260 610 250" stroke="rgb(236, 72, 153)" stroke-width="2" fill="none" stroke-dasharray="5,5"/>
  <text x="820" y="365" font-family="Inter, sans-serif" font-size="12" fill="rgb(236, 72, 153)">MEM/WB → EX</text>
  
  <!-- Hazard detection unit -->
  <rect x="100" y="410" width="500" height="160" rx="6" fill="rgba(245, 158, 11, 0.05)" stroke="rgba(245, 158, 11, 0.3)" stroke-width="2"/>
  <text x="350" y="440" font-family="Space Grotesk, sans-serif" font-size="18" font-weight="700" fill="rgb(245, 158, 11)" text-anchor="middle">Hazard Detection Unit</text>
  
  <text x="130" y="475" font-family="Inter, sans-serif" font-size="14" fill="rgba(229, 231, 235, 0.8)">• Data Hazards (RAW)</text>
  <text x="140" y="500" font-family="JetBrains Mono, monospace" font-size="12" fill="rgba(229, 231, 235, 0.6)">→ EX/MEM forwarding</text>
  <text x="140" y="520" font-family="JetBrains Mono, monospace" font-size="12" fill="rgba(229, 231, 235, 0.6)">→ MEM/WB forwarding</text>
  
  <text x="380" y="475" font-family="Inter, sans-serif" font-size="14" fill="rgba(229, 231, 235, 0.8)">• Load-Use Hazards</text>
  <text x="390" y="500" font-family="JetBrains Mono, monospace" font-size="12" fill="rgba(229, 231, 235, 0.6)">→ Pipeline stall (1 cycle)</text>
  
  <text x="130" y="545" font-family="Inter, sans-serif" font-size="14" fill="rgba(229, 231, 235, 0.8)">• Control Hazards</text>
  <text x="140" y="560" font-family="JetBrains Mono, monospace" font-size="12" fill="rgba(229, 231, 235, 0.6)">→ Branch prediction + flush</text>
  
  <!-- Performance metrics -->
  <rect x="620" y="410" width="500" height="160" rx="6" fill="rgba(16, 185, 129, 0.05)" stroke="rgba(16, 185, 129, 0.3)" stroke-width="2"/>
  <text x="870" y="440" font-family="Space Grotesk, sans-serif" font-size="18" font-weight="700" fill="rgb(16, 185, 129)" text-anchor="middle">Performance</text>
  
  <text x="650" y="480" font-family="Inter, sans-serif" font-size="14" fill="rgba(229, 231, 235, 0.8)">CPI (Cycles Per Instruction)</text>
  <text x="650" y="510" font-family="JetBrains Mono, monospace" font-size="28" font-weight="700" fill="rgb(16, 185, 129)">≈ 1.15</text>
  
  <text x="880" y="480" font-family="Inter, sans-serif" font-size="14" fill="rgba(229, 231, 235, 0.8)">Stall Rate</text>
  <text x="880" y="510" font-family="JetBrains Mono, monospace" font-size="28" font-weight="700" fill="rgb(34, 211, 238)">~12%</text>
  
  <text x="650" y="545" font-family="Inter, sans-serif" font-size="12" fill="rgba(229, 231, 235, 0.6)">✓ Forwarding reduces stalls by 60%</text>
  <text x="650" y="562" font-family="Inter, sans-serif" font-size="12" fill="rgba(229, 231, 235, 0.6)">✓ Near-optimal throughput achieved</text>
  
  <!-- Example instruction flow -->
  <text x="100" y="620" font-family="Space Grotesk, sans-serif" font-size="16" font-weight="600" fill="rgba(229, 231, 235, 0.9)">Example: RAW Hazard with Forwarding</text>
  
  <rect x="100" y="640" width="1020" height="120" rx="4" fill="rgba(18,18,18,0.8)"/>
  
  <text x="130" y="670" font-family="JetBrains Mono, monospace" font-size="13" fill="rgb(245, 158, 11)">add $t0, $t1, $t2</text>
  <text x="130" y="690" font-family="JetBrains Mono, monospace" font-size="13" fill="rgb(34, 211, 238)">sub $t3, $t0, $t4</text>
  <text x="130" y="710" font-family="JetBrains Mono, monospace" font-size="13" fill="rgba(229, 231, 235, 0.6)">and $t5, $t3, $t6</text>
  <text x="130" y="735" font-family="JetBrains Mono, monospace" font-size="11" fill="rgba(229, 231, 235, 0.4)">← RAW: $t0 produced then used</text>
  
  <text x="600" y="665" font-family="Inter, sans-serif" font-size="12" fill="rgba(229, 231, 235, 0.7)">Cycle 1: add in IF</text>
  <text x="600" y="685" font-family="Inter, sans-serif" font-size="12" fill="rgba(229, 231, 235, 0.7)">Cycle 2: add in ID, sub in IF</text>
  <text x="600" y="705" font-family="Inter, sans-serif" font-size="12" fill="rgba(229, 231, 235, 0.7)">Cycle 3: add in EX, sub in ID</text>
  <text x="600" y="725" font-family="Inter, sans-serif" font-size="12" fill="rgb(147, 51, 234)">Cycle 4: Forward $t0 from EX/MEM → EX</text>
  <text x="600" y="745" font-family="JetBrains Mono, monospace" font-size="11" fill="rgb(16, 185, 129)">→ No stall required!</text>
</svg>
